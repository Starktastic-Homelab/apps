apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-ntfy-config
  namespace: monitoring
data:
  config.yml: |
    http:
      addr: :8000
    ntfy:
      baseurl: http://ntfy.operations.svc.cluster.local
      notification:
        topic: alerts
        priority: |
          status == "firing" ? "urgent" : "default"
        tags:
          - tag: rotating_light
            condition: status == "firing"
          - tag: white_check_mark
            condition: status == "resolved"
        templates:
          title: |
            {{ if eq .Status "resolved" }}âœ… Resolved{{ else }}ðŸš¨ Firing{{ end }}: {{ if index .Annotations "summary" }}{{ index .Annotations "summary" }}{{ else }}{{ .Labels.alertname }}{{ end }}
          description: |
            {{ if index .Annotations "description" }}{{ index .Annotations "description" }}{{ end }}
            Severity: {{ if .Labels.severity }}{{ .Labels.severity }}{{ else }}unknown{{ end }}
            Namespace: {{ if .Labels.namespace }}{{ .Labels.namespace }}{{ else }}n/a{{ end }}
